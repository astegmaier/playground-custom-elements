<!DOCTYPE html>
<html>
  <head>
    <title>Custom Elements Playground</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/a11y-light.min.css"
      integrity="sha512-WDk6RzwygsN9KecRHAfm9HTN87LQjqdygDmkHSJxVkVI7ErCZ8ZWxP6T8RvBujY1n2/E4Ac+bn2ChXnp5rnnHA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      iframe { 
        width: 320px;
        height: 100px;
        background-color: lightgray;
        border: 2px solid black;
        box-sizing: border-box;
      }
      #iframe-container {
        height: 110px;
        background-color: grey;
        padding: 5px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <h1>
      Custom Elements Playground
    </h1>
    <p>
      This project shows how it would be possible to use <a href="https://web.dev/articles/custom-elements-v1">custom elements</a> to wrap an iframe to achieve these goals:
    </p>
    <ol>
      <li>Prevent code on the host page from accessing the iframe directly - and prevent memory leaks that could occur if retainers still connected the iframe to the GC root after it is removed.</li>
      <li>Get a reliable, performant signal about when the host has removed iframe wrapper from the DOM (or any of it's parents).</li>
    </ol>
    <ol>
      <li><button id="add-custom-element-iframe">Add iframe wrapper custom element</button></li>
      <li><button id="remove-custom-element-iframe">Remove iframe wrapper custom element</button></li>
      <li><button id="attempt-to-access-iframe">Attempt to access the wrapped iframe</button></li>
    </ol>
    </div>
    <hr />
    <div>
      We are running the following JavaScript code on this page (see
      <a href="https://github.com/astegmaier/playground-hung-iframe-promise"
        >github repo</a
      >):
    </div>
    <pre><code class="language-javascript" id="code"></code></pre>
    <script src="./index.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"
      integrity="sha512-bgHRAiTjGrzHzLyKOnpFvaEpGzJet3z4tZnXGjpsCcqOnAH6VGUx9frc5bcIhKTVLEiCO6vEhNAgx5jtLUYrfA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
      fetch("./index.js")
        .then((response) => response.text())
        .then((code) => (document.getElementById("code").textContent = code))
        .then(() => hljs.highlightAll());
    </script>
  </body>
</html>
